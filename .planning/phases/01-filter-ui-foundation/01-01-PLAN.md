---
phase: 01-filter-ui-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/PlaylistFilterDropdown.vue
  - src/views/Playlist.vue
autonomous: false

must_haves:
  truths:
    - "User can see a filter toggle button with funnel icon in playlist header"
    - "User can click toggle button to open dropdown menu showing marks"
    - "User can select/deselect marks using checkboxes with visual indicators"
    - "User can use 'Clear all' / 'Select all' / 'Deselect all' control buttons"
    - "Toggle button shows active state (color + dot indicator) when marks are selected"
    - "User can close dropdown by clicking outside or pressing Escape key"
    - "User can toggle checkboxes using Enter/Space keys"
  artifacts:
    - path: "src/components/PlaylistFilterDropdown.vue"
      provides: "Filter dropdown component with multi-select checkboxes"
      min_lines: 80
      exports: ["default (Vue component)"]
    - path: "src/views/Playlist.vue"
      provides: "Playlist view with integrated filter button"
      contains: "PlaylistFilterDropdown"
  key_links:
    - from: "src/components/PlaylistFilterDropdown.vue"
      to: "reka-ui"
      via: "import statements"
      pattern: "import.*from 'reka-ui'"
    - from: "src/components/PlaylistFilterDropdown.vue"
      to: "checkbox behavior"
      via: "@select.prevent to keep dropdown open"
      pattern: "@select\\.prevent"
    - from: "src/components/PlaylistFilterDropdown.vue"
      to: "active state indication"
      via: "data-toggle attribute binding"
      pattern: ":data-toggle"
    - from: "src/views/Playlist.vue"
      to: "src/components/PlaylistFilterDropdown.vue"
      via: "component import and usage"
      pattern: "import.*PlaylistFilterDropdown|<PlaylistFilterDropdown"
---

<objective>
Build a standalone filter component for playlist view that displays marks with multi-select checkboxes, keyboard navigation support, and visual state feedback. This establishes the UI foundation for mark-based filtering (logic implementation deferred to Phase 2).

Purpose: Enables users to interact with filter controls and see visual feedback, preparing the interface for reactive filtering behavior in the next phase.

Output:
- PlaylistFilterDropdown.vue component with Reka UI-based multi-select dropdown
- Integrated filter toggle button in Playlist.vue header
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-filter-ui-foundation/01-CONTEXT.md
@.planning/phases/01-filter-ui-foundation/01-RESEARCH.md
@src/components/UiDropdownMenu.vue
@src/components/PlaylistDropdownMenu.vue
@src/views/Playlist.vue
@pika.config.js
</context>

<tasks>

<task type="auto">
  <name>Create PlaylistFilterDropdown component with multi-select UI</name>
  <files>src/components/PlaylistFilterDropdown.vue</files>
  <action>
Create a Vue 3 component following the established UiDropdownMenu.vue pattern with these specifics:

**Component Structure:**
- Use Reka UI primitives: `DropdownMenuRoot`, `DropdownMenuTrigger`, `DropdownMenuPortal`, `DropdownMenuContent`, `DropdownMenuCheckboxItem`, `DropdownMenuItemIndicator`, `DropdownMenuSeparator`
- Define props: `marks: string[]` (list of mark labels), `modelValue: string[]` (selected marks for v-model support)
- Emit `update:modelValue` when selections change
- Use `ref<boolean>` for dropdown open state with `v-model:open`

**Toggle Button (Trigger):**
- Use `<button :class="pika('icon-btn-toggle')" :data-toggle="hasActiveFilters">`
- Icon: `i-f7:line-horizontal-3-decrease` (modern filter icon from Framework7 set)
- Computed `hasActiveFilters`: returns `true` when `modelValue.length > 0`
- Use `asChild` on `DropdownMenuTrigger` to wrap the button

**Dropdown Content:**
- Apply PikaCSS styling matching UiDropdownMenu.vue:
  - Content: `pika('card', { padding: '8px', minWidth: '200px', zIndex: 2 })`
  - Checkboxes: `pika('hover-mask', { display: 'flex', alignItems: 'center', gap: '8px', padding: '12px', cursor: 'pointer' })`
- Control buttons section at top:
  - "Select all" button: sets all marks as selected
  - "Deselect all" button: clears all selections
  - "Clear all" button: alias for deselect all (same behavior)
  - Style buttons: `pika('primary-plain-btn', { fontSize: '12px', padding: '4px 8px' })`
  - Wrap in flex container with gap
- Add `<DropdownMenuSeparator />` after control buttons
- Render `DropdownMenuCheckboxItem` for each mark in `marks` prop:
  - Use `v-for="mark in marks" :key="mark"`
  - Bind `:checked="modelValue.includes(mark)"`
  - Add `@select.prevent` to prevent dropdown from closing on checkbox click
  - Use `@update:checked` to emit updated `modelValue` array
  - Show checkmark indicator using `DropdownMenuItemIndicator` with `i-f7:checkmark` icon

**Keyboard Navigation:**
- Reka UI handles this automatically (Enter/Space to toggle, Escape to close, Tab for focus movement)
- No custom keyboard handlers needed

**Why these choices:**
- `@select.prevent`: Without this, Reka UI's default behavior closes dropdown after each checkbox click (bad UX for multi-select)
- `icon-btn-toggle` with `data-toggle`: Leverages existing PikaCSS pattern that automatically shows primary color + dot indicator when active
- `DropdownMenuPortal`: Ensures dropdown renders in correct z-index layer and handles viewport collision
- Following UiDropdownMenu.vue patterns: Maintains visual consistency across the app

**Empty State:**
- If `marks.length === 0`, show message "No marks available" instead of checkbox list
- This satisfies requirement EMPTY-01 (deferred to Phase 3, but implement early for completeness)
  </action>
  <verify>
Run these checks:
1. `npm run type-check` - TypeScript compilation passes with no errors
2. Component file exists and has expected imports: `grep "from 'reka-ui'" src/components/PlaylistFilterDropdown.vue`
3. Component has `@select.prevent` on checkbox items: `grep "@select.prevent" src/components/PlaylistFilterDropdown.vue`
4. Component has v-model support: `grep "modelValue" src/components/PlaylistFilterDropdown.vue`
  </verify>
  <done>
PlaylistFilterDropdown.vue component exists with:
- Reka UI dropdown structure (Root, Trigger, Portal, Content, CheckboxItem)
- v-model:modelValue prop for two-way binding of selected marks
- marks prop accepting string array
- Toggle button with icon-btn-toggle styling and data-toggle binding
- Control buttons (Select all, Deselect all, Clear all) at top of dropdown
- Checkbox items with @select.prevent to keep menu open during multi-select
- Keyboard navigation working via Reka UI's built-in support
- PikaCSS styling consistent with UiDropdownMenu.vue
- TypeScript types correctly defined
  </done>
</task>

<task type="auto">
  <name>Integrate PlaylistFilterDropdown into Playlist header</name>
  <files>src/views/Playlist.vue</files>
  <action>
Add PlaylistFilterDropdown component to the Playlist view header:

**Import:**
- Add import statement: `import PlaylistFilterDropdown from '@/components/PlaylistFilterDropdown.vue'`

**State Management:**
- Add ref for selected marks: `const selectedMarks = ref<string[]>([])`
- For this phase, use mock data for marks prop: `const marks = ref(['Mark A', 'Mark B', 'Mark C'])`
- Note: Real mark extraction will be implemented in Phase 2 (FILTER-01, FILTER-02)

**Integration Point:**
- Locate the header section in the template (around line 87-150, between the marquee title and the random toggle button)
- Insert PlaylistFilterDropdown component between `<UiMarquee>` and the random toggle button:

```vue
<PlaylistFilterDropdown
  v-model="selectedMarks"
  :marks="marks"
/>
```

**Placement Rationale:**
- Position matches requirement UI-02: "alongside PlaylistDropdownMenu in playlist header"
- PlaylistDropdownMenu appears later in the header (after play button, around line 150+)
- Placing filter before random toggle maintains logical left-to-right flow: Title → Filter → Controls → Actions

**What NOT to do:**
- Do NOT implement filtering logic yet (Phase 2: FILTER-03, FILTER-04, FILTER-07)
- Do NOT implement mark extraction from playlist data yet (Phase 2: FILTER-01, FILTER-02)
- Do NOT add result count display yet (Phase 3: EMPTY-03)
- Just wire up the component with mock data to verify UI interactions work correctly
  </action>
  <verify>
Run these checks:
1. `npm run type-check` - TypeScript compilation passes
2. Component imported: `grep "PlaylistFilterDropdown" src/views/Playlist.vue`
3. Component rendered in template: `grep "<PlaylistFilterDropdown" src/views/Playlist.vue`
4. Dev server starts without errors: `npm run dev` (check console output for errors)
  </verify>
  <done>
Playlist.vue updated with:
- PlaylistFilterDropdown component imported from @/components/PlaylistFilterDropdown.vue
- selectedMarks ref initialized as empty array
- marks ref with mock data ['Mark A', 'Mark B', 'Mark C']
- PlaylistFilterDropdown component rendered in header between title and random toggle
- v-model binding to selectedMarks working
- No TypeScript or runtime errors
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Standalone filter UI component integrated into playlist header with:
- Toggle button showing funnel icon (inactive state by default)
- Dropdown menu with checkboxes for mock marks (Mark A, Mark B, Mark C)
- Control buttons for Select all / Deselect all / Clear all
- Toggle button showing active state (primary color + dot) when marks selected
- Dropdown stays open during checkbox interactions
- Keyboard navigation working (Enter/Space to toggle, Escape to close)
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to any playlist in the browser (e.g., http://localhost:5173/playlist/all)
3. Visual checks:
   - [ ] Filter toggle button visible in playlist header with filter icon
   - [ ] Button positioned between playlist title and random toggle button
   - [ ] Button matches styling of other header buttons (icon-btn style)
4. Interaction checks:
   - [ ] Click toggle button → dropdown opens showing "Select all", "Deselect all", "Clear all" buttons and 3 checkboxes (Mark A, B, C)
   - [ ] Click a checkbox → checkbox becomes checked, dropdown stays open (does NOT close)
   - [ ] Select 2+ marks → toggle button turns primary color and shows small dot indicator at bottom
   - [ ] Click outside dropdown → dropdown closes
   - [ ] Click "Clear all" → all checkboxes become unchecked, toggle button returns to inactive state
   - [ ] Click "Select all" → all checkboxes become checked, toggle button shows active state
5. Keyboard checks:
   - [ ] Press Tab to focus toggle button, press Enter → dropdown opens
   - [ ] Press Tab to move focus to checkboxes
   - [ ] Press Space or Enter on focused checkbox → checkbox toggles
   - [ ] Press Escape → dropdown closes
6. Edge cases:
   - [ ] Reopen dropdown after closing → previous selections preserved
   - [ ] Select all marks, clear all marks → UI state updates correctly

**Expected Behavior:**
- All visual elements render correctly with consistent styling
- Multi-select works without closing dropdown after each click
- Active/inactive states of toggle button clearly visible
- Keyboard navigation smooth and intuitive
- No console errors or warnings

**Common Issues to Check:**
- Dropdown closing after checkbox click? → Missing `@select.prevent`
- Toggle button not showing active state? → Check `data-toggle` binding
- Checkboxes not updating? → Check v-model wiring
- Styling inconsistent? → Verify PikaCSS class names match patterns
  </how-to-verify>
  <resume-signal>
Type "approved" if all checks pass, or describe any issues found (styling problems, interaction bugs, missing features).
  </resume-signal>
</task>

</tasks>

<verification>
After all tasks complete and checkpoint passes:

1. **Component Files:**
   - `src/components/PlaylistFilterDropdown.vue` exists and exports a Vue component
   - `src/views/Playlist.vue` imports and renders PlaylistFilterDropdown

2. **Type Safety:**
   - `npm run type-check` passes with no errors

3. **Visual Requirements (from checkpoint):**
   - Toggle button visible with filter icon (UI-01)
   - Toggle button positioned in playlist header (UI-02)
   - Active state shows when filters applied (UI-03)
   - Inactive state shows when no filters (UI-04)
   - Dropdown displays when button clicked (UI-05)
   - Checkboxes visible for each mark (UI-07)
   - Control buttons present (UI-09, UI-10, UI-11)
   - Dropdown closes on outside click (UI-12)
   - Keyboard navigation functional (UI-13, UI-14)

4. **Code Quality:**
   - Follows established patterns from UiDropdownMenu.vue
   - Uses Reka UI primitives correctly
   - PikaCSS styling consistent with existing components
   - TypeScript types properly defined
   - No console errors or warnings
</verification>

<success_criteria>
Phase 1 is complete when:

1. **Functional Success:**
   - User can open filter dropdown from playlist header
   - User can select/deselect multiple marks without dropdown closing
   - User can use control buttons (Select all / Clear all / Deselect all)
   - Toggle button visually indicates active/inactive state
   - Dropdown closes on outside click or Escape key
   - Keyboard navigation works (Tab, Enter, Space, Escape)

2. **Technical Success:**
   - PlaylistFilterDropdown component follows Vue 3 Composition API best practices
   - Component uses Reka UI for accessibility and keyboard support
   - Styling matches existing design system (PikaCSS patterns)
   - TypeScript compilation passes without errors
   - No runtime errors in browser console

3. **Requirements Coverage:**
   - All Phase 1 requirements from ROADMAP.md satisfied (UI-01 through UI-14)
   - Component is standalone and ready for Phase 2 integration (filtering logic)
   - Code is maintainable and follows project conventions

4. **User Experience:**
   - Filter UI feels native to the application
   - Interactions are smooth and responsive
   - Visual feedback is clear and immediate
   - Keyboard navigation is intuitive

**Ready for Phase 2:** With this UI foundation in place, Phase 2 can implement mark extraction from playlist data and reactive filtering logic without modifying the component's interface.
</success_criteria>

<output>
After completion, create `.planning/phases/01-filter-ui-foundation/01-01-SUMMARY.md` following the summary template structure.

Summary should document:
- Component architecture (props, events, state)
- Integration points in Playlist.vue
- Styling patterns used (PikaCSS shortcuts)
- Reka UI primitives utilized
- Any deviations from the plan (if applicable)
- Mock data structure for marks (to be replaced in Phase 2)
- Screenshots or visual documentation (optional but helpful)
</output>
